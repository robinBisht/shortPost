(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{292:function(e,t,n){e.exports=n(481)},298:function(e,t,n){},481:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(76),l=n.n(o),c=n(36),s=n(66),m=n(494),i=(n(297),n(298),n(20)),u=n(104),d=n(248),b=n.n(d),p={user:null};if(localStorage.getItem("jwtToken")){var E=b()(localStorage.getItem("jwtToken"));1e3*E.exp<Date.now()?localStorage.removeItem("jwtToken"):p.user=E}var g=Object(a.createContext)({user:null,login:function(e){},logout:function(){}});function f(e,t){switch(t.type){case"LOGIN":return Object(u.a)({},e,{user:t.payload});case"LOGOUT":return Object(u.a)({},e,{user:null});default:return e}}function v(e){var t=Object(a.useReducer)(f,p),n=Object(i.a)(t,2),o=n[0],l=n[1];return r.a.createElement(g.Provider,Object.assign({value:{user:o.user,login:function(e){localStorage.setItem("jwtToken",e.token),l({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),l({type:"LOGOUT"})}}},e))}var h=n(249);var j=function(e){var t=e.component,n=Object(h.a)(e,["component"]),o=Object(a.useContext)(g).user;return r.a.createElement(s.b,Object.assign({},n,{render:function(e){return o?r.a.createElement(s.a,{to:"/"}):r.a.createElement(t,e)}}))},O=n(501);var y=function(){var e=Object(a.useContext)(g),t=e.user,n=e.logout,o=window.location.pathname,l="/"===o?"home":o.substr(1),s=Object(a.useState)(l),m=Object(i.a)(s,2),u=m[0],d=m[1],b=function(e,t){var n=t.name;return d(n)};return t?r.a.createElement(O.a,{pointing:!0,secondary:!0,size:"massive",color:"teal"},r.a.createElement(O.a.Item,{name:t.username,active:!0,as:c.b,to:"/"}),r.a.createElement(O.a.Menu,{position:"right"},r.a.createElement(O.a.Item,{name:"logout",onClick:n,as:c.b,to:"/login"}))):r.a.createElement(O.a,{pointing:!0,secondary:!0,size:"massive",color:"teal"},r.a.createElement(O.a.Item,{name:"home",active:"home"===u,onClick:b,as:c.b,to:"/"}),r.a.createElement(O.a.Menu,{position:"right"},r.a.createElement(O.a.Item,{name:"register",active:"register"===u,onClick:b,as:c.b,to:"/register"}),r.a.createElement(O.a.Item,{name:"login",active:"login"===u,onClick:b,as:c.b,to:"/login"})))},C=n(32),I=n(502),w=n(504),k=n(33),P=n(34),S=n.n(P);function $(){var e=Object(k.a)(["\n  {\n    getPosts {\n      id\n      body\n      createdAt\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"]);return $=function(){return e},e}var x=S()($()),N=n(499),A=n(281),D=n(498),L=n(500),R=n(90),T=n(137),Q=n(106),U=n.n(Q);function q(){var e=Object(k.a)(["\n    mutation likePost($postId:ID!){\n        likePost(postId:$postId){\n            id\n            likes{\n                id\n                username\n            }\n            likeCount\n        }\n    }\n"]);return q=function(){return e},e}var z=S()(q()),G=function(e){var t=e.user,n=e.post,o=n.id,l=n.likeCount,s=n.likes,m=Object(a.useState)(!1),u=Object(i.a)(m,2),d=u[0],b=u[1];Object(a.useEffect)((function(){t&&s.find((function(e){return e.username===t.username}))?b(!0):b(!1)}),[t,s]);var p=Object(C.a)(z,{variables:{postId:o}}),E=Object(i.a)(p,1)[0],g=t?d?r.a.createElement(L.a,{color:"teal"},r.a.createElement(R.a,{name:"heart"})):r.a.createElement(L.a,{color:"teal",basic:!0},r.a.createElement(R.a,{name:"heart"})):r.a.createElement(L.a,{as:c.b,to:"/login",color:"teal",basic:!0},r.a.createElement(R.a,{name:"heart"}));return r.a.createElement(L.a,{as:"div",labelPosition:"right",onClick:E},r.a.createElement(D.a,{inverted:!0,content:d?"Unlike":"Like",trigger:g}),r.a.createElement(T.a,{basic:!0,color:"teal",pointing:"left"},l))},M=n(496);function B(){var e=Object(k.a)(["\n  mutation deleteComment($postId:ID!, $commentId:ID!){\n    deleteComment(postId: $postId, commentId:$commentId){\n      id\n      comments{\n        id\n        username\n        createdAt\n        body\n\n      }\n      commentCount\n    }\n  }\n"]);return B=function(){return e},e}function H(){var e=Object(k.a)(["\n    mutation deletePost($postId:ID!){\n        deletePost(postId:$postId)\n    }\n"]);return H=function(){return e},e}var F=S()(H()),W=S()(B()),J=function(e){var t=e.callback,n=e.postId,o=e.commentId,l=Object(a.useState)(!1),c=Object(i.a)(l,2),s=c[0],m=c[1],u=o?W:F,d=Object(C.a)(u,{update:function(e){if(m(!1),!o){var a=e.readQuery({query:x});a.getPosts=a.getPosts.filter((function(e){return e.id!==n})),e.writeQuery({query:x,data:a})}t&&t()},variables:{postId:n,commentId:o}}),b=Object(i.a)(d,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,{inverted:!0,content:o?"Delete comment":"Delete Post",trigger:r.a.createElement(L.a,{as:"div",color:"red",floated:"right",onClick:function(){return m(!0)}},r.a.createElement(R.a,{name:"trash",style:{margin:0}}))}),r.a.createElement(M.a,{open:s,onCancel:function(){return m(!1)},onConfirm:b}))};var V=function(e){var t=e.post,n=t.body,o=t.createdAt,l=t.id,s=t.username,m=t.likeCount,i=t.commentCount,u=t.likes,d=Object(a.useContext)(g).user;return r.a.createElement(N.a,null,r.a.createElement(N.a.Content,null,r.a.createElement(A.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),r.a.createElement(N.a.Header,null,s),r.a.createElement(N.a.Meta,{as:c.b,to:"/posts/".concat(l)}," ",U()(o).fromNow(!0)," "),r.a.createElement(N.a.Description,null,n)),r.a.createElement(N.a.Content,{extra:!0},r.a.createElement(G,{user:d,post:{id:l,likes:u,likeCount:m}}),r.a.createElement(D.a,{content:"Comment on post",inverted:!0,trigger:r.a.createElement(L.a,{labelPosition:"right",as:c.b,to:"/posts/${id}"},r.a.createElement(L.a,{color:"teal",basic:!0},r.a.createElement(R.a,{name:"comments"})),r.a.createElement(T.a,{basic:!0,color:"teal",pointing:"left"},i))}),d&&d.username===s&&r.a.createElement(J,{postId:l})))},K=n(495),X=n(41),Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(a.useState)(t),r=Object(i.a)(n,2),o=r[0],l=r[1],c=function(e){l(Object(u.a)({},o,Object(X.a)({},e.target.name,e.target.value)))},s=function(t){t.preventDefault(),e()};return{onChange:c,onSubmit:s,values:o}};function Z(){var e=Object(k.a)(["\nmutation createPost($body:String!){\n    createPost(body:$body){\n        id\n        body\n        createdAt\n        username\n        likes{\n            id\n            username\n            createdAt\n        }\n        likeCount\n        comments{\n            id\n            body\n            username\n            createdAt\n        }\n        commentCount\n    }\n}\n"]);return Z=function(){return e},e}var _=S()(Z()),ee=function(){var e=Y((function(){c()}),{body:""}),t=e.values,n=e.onChange,a=e.onSubmit,o=Object(C.a)(_,{variables:t,update:function(e,n){var a=e.readQuery({query:x,variables:t});a.getPosts.unshift(n.data.createPost),e.writeQuery({query:x,data:a}),t.body=""}}),l=Object(i.a)(o,2),c=l[0],s=l[1].error;return r.a.createElement(r.a.Fragment,null,r.a.createElement(K.a,{onSubmit:a},r.a.createElement("h2",null,"Create a Post:"),r.a.createElement(K.a.Field,null,r.a.createElement(K.a.Input,{placeholder:"Hi World",name:"body",onChange:n,value:t.body,error:!!s}),r.a.createElement(L.a,{type:"submit",color:"teal"},"Submit"))),s&&r.a.createElement("div",{className:"ui error message"},r.a.createElement("ul",{className:"list"},r.a.createElement("li",null," ",s.graphQLErrors[0].message," "))))};var te=function(){var e=Object(a.useContext)(g).user,t=Object(C.b)(x),n=t.loading,o=t.data;return r.a.createElement(I.a,{columns:3},r.a.createElement(I.a.Row,{className:"page-title"},r.a.createElement("h1",null,"Recent Posts")),r.a.createElement(I.a.Row,null,e&&r.a.createElement(I.a.Column,null,r.a.createElement(ee,null)),n?r.a.createElement("div",{className:"ui active centered inline loader"}):r.a.createElement(w.a.Group,null,o.getPosts&&o.getPosts.map((function(e){return r.a.createElement(I.a.Column,{key:e.id,style:{marginBottom:20}},r.a.createElement(V,{post:e}))})))))};function ne(){var e=Object(k.a)(["\n    mutation login(\n        $username: String!,\n        $password: String!\n    ){\n        login(\n            username: $username,\n            password: $password\n        ){\n            id email username createdAt token\n        }\n    }\n"]);return ne=function(){return e},e}var ae=S()(ne()),re=function(e){var t=Object(a.useContext)(g),n=Object(a.useState)({}),o=Object(i.a)(n,2),l=o[0],c=o[1],s=Y((function(){E()}),{username:"",password:""}),m=s.onChange,u=s.onSubmit,d=s.values,b=Object(C.a)(ae,{update:function(n,a){t.login(a.data.login),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),p=Object(i.a)(b,2),E=p[0],f=p[1].loading;return r.a.createElement("div",{className:"form-container"},r.a.createElement(K.a,{onSubmit:u,noValidate:!0,className:f?"loading":""},r.a.createElement("h1",null,"Login"),r.a.createElement(K.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",error:!!l.username,value:d.username,onChange:m}),r.a.createElement(K.a.Input,{label:"Password",placeholder:"Password..",name:"password",type:"text",error:!!l.password,value:d.password,onChange:m}),r.a.createElement(L.a,{type:"submit",primary:!0},"Login")),Object.keys(l).length>0&&r.a.createElement("div",{className:"ui error message"},r.a.createElement("ul",{className:"list"},Object.values(l).map((function(e){return r.a.createElement("li",{key:e}," ",e," ")})))))};function oe(){var e=Object(k.a)(["\n    mutation register(\n        $username: String!\n        $email: String!\n        $password: String!\n        $confirmPassword:String!\n    ){\n        register(\n            registerInput: {\n                username: $username\n                email: $email\n                password:$password\n                confirmPassword:$confirmPassword\n            }\n        ){\n            id email username createdAt token\n        }\n    }\n"]);return oe=function(){return e},e}var le=S()(oe()),ce=function(e){var t=Object(a.useContext)(g),n=Object(a.useState)({}),o=Object(i.a)(n,2),l=o[0],c=o[1],s=Y((function(){E()}),{username:"",email:"",password:"",confirmPassword:""}),m=s.onChange,u=s.onSubmit,d=s.values,b=Object(C.a)(le,{update:function(n,a){t.login(a.data.login),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:d}),p=Object(i.a)(b,2),E=p[0],f=p[1].loading;return r.a.createElement("div",{className:"form-container"},r.a.createElement(K.a,{onSubmit:u,noValidate:!0,className:f?"loading":""},r.a.createElement("h1",null,"Register"),r.a.createElement(K.a.Input,{label:"Username",placeholder:"Username..",name:"username",type:"text",error:!!l.username,value:d.username,onChange:m}),r.a.createElement(K.a.Input,{label:"Email",placeholder:"Email..",name:"email",type:"text",error:!!l.email,value:d.email,onChange:m}),r.a.createElement(K.a.Input,{label:"Password",placeholder:"Password..",name:"password",error:!!l.password,type:"text",value:d.password,onChange:m}),r.a.createElement(K.a.Input,{label:"confirmPassword",placeholder:"Confirm Password..",name:"confirmPassword",error:!!l.confirmPassword,type:"text",value:d.confirmPassword,onChange:m}),r.a.createElement(L.a,{type:"submit",primary:!0},"Register")),Object.keys(l).length>0&&r.a.createElement("div",{className:"ui error message"},r.a.createElement("ul",{className:"list"},Object.values(l).map((function(e){return r.a.createElement("li",{key:e}," ",e," ")})))))};function se(){var e=Object(k.a)(["\n    mutation($postId:ID!, $body:String!){\n        createComment(postId: $postId, body:$body){\n            id\n            comments{\n                id \n                body\n                createdAt\n                username\n            }\n            commentCount\n        }\n    }\n"]);return se=function(){return e},e}function me(){var e=Object(k.a)(["\n    query($postId:ID!){\n        getPost(postId: $postId){\n            id\n            body\n            createdAt\n            username\n            likeCount\n            likes{\n                username\n            }\n\n            commentCount\n            comments{\n                id\n                username\n                createdAt\n                body\n            }\n        }\n    }\n"]);return me=function(){return e},e}var ie=S()(me()),ue=S()(se()),de=function(e){var t,n=e.match.params.postId,o=Object(a.useContext)(g).user,l=Object(a.useRef)(null),c=Object(a.useState)(""),s=Object(i.a)(c,2),m=s[0],u=s[1],d=Object(C.b)(ie,{variables:{postId:n}}).data,b=Object(C.a)(ue,{update:function(){u(""),l.current.blur()},variables:{postId:n,body:m}}),p=Object(i.a)(b,1)[0];if(d.getPost){var E=d.getPost,f=E.id,v=E.body,h=E.createdAt,j=E.username,O=E.comments,y=E.likes,w=E.likeCount,k=E.commentCount;t=r.a.createElement(I.a,null,r.a.createElement(I.a.Row,null,r.a.createElement(I.a.Column,{width:2},r.a.createElement(A.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"right"})),r.a.createElement(I.a.Column,{width:10},r.a.createElement(N.a,{fluid:!0},r.a.createElement(N.a.Content,null,r.a.createElement(N.a.Header,null,j),r.a.createElement(N.a.Meta,null,U()(h).fromNow()),r.a.createElement(N.a.Content,null,v)),r.a.createElement("hr",null),r.a.createElement(N.a.Content,{extra:!0},r.a.createElement(G,{user:o,post:{id:f,likeCount:w,likes:y}}),r.a.createElement(L.a,{as:"div",labelPosition:"right",onClick:function(){return console.log("Comment on post")}},r.a.createElement(L.a,{basic:!0,color:"blue",pointing:"left"},r.a.createElement(R.a,{name:"comments"})),r.a.createElement(T.a,{basic:!0,color:"blue",pointing:"left"},k)),o&&o.username===j&&r.a.createElement(J,{postId:f,callback:function(){e.history.push("/")}}))),o&&r.a.createElement(N.a,{fluid:!0},r.a.createElement(N.a.Content,null,r.a.createElement("p",null,"Post a comment"),r.a.createElement(K.a,null,r.a.createElement("div",{className:"ui action input fluid"},r.a.createElement("input",{type:"text",placeholder:"Comment...",name:"comment",value:m,onChange:function(e){return u(e.target.value)},ref:l}),r.a.createElement("button",{type:"submit",className:"ui button teal",disabled:""===m.trim(),onClick:p},"Submit"))))),O.map((function(e){return r.a.createElement(N.a,{fluid:!0,key:e.id},r.a.createElement(N.a.Content,null,o&&o.username===e.username&&r.a.createElement(J,{postId:f,commentId:e.id}),r.a.createElement(N.a.Header,null,e.username),r.a.createElement(N.a.Meta,null," ",U()(e.createdAt).fromNow()," "),r.a.createElement(N.a.Description,null," ",e.body," ")))})))))}else t=r.a.createElement("p",null," Loading Post...... ");return t};var be=function(){return r.a.createElement(v,null,r.a.createElement(c.a,null,r.a.createElement(m.a,null,r.a.createElement(y,null),r.a.createElement(s.b,{exact:!0,path:"/",component:te}),r.a.createElement(j,{exact:!0,path:"/login",component:re}),r.a.createElement(j,{exact:!0,path:"/register",component:ce}),r.a.createElement(s.b,{exact:!0,path:"/posts/:postId",component:de}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var pe=n(67),Ee=n(282),ge=n(283),fe=n(28),ve=n(280),he=Object(ge.a)({uri:"http://localhost:5000"}),je=Object(ve.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),Oe=new pe.c({link:je.concat(he),cache:new Ee.a}),ye=r.a.createElement(fe.a,{client:Oe},r.a.createElement(be,null));l.a.render(ye,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[292,1,2]]]);
//# sourceMappingURL=main.e52c82f8.chunk.js.map